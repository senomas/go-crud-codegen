{{define "StoreInterface" -}}
// FILE-b2bab6a74adbe2e8dd47ebdcb76db7c4: model/gen__{{snakeCase .ID}}_store.go
// Code generated by apigen. DO NOT EDIT.
// GENERATED: {{now}}

package {{.Package}}

import (
	"context"
	"database/sql"
	"encoding/json"
	"fmt"
	"log/slog"
	"strings"
	"{{.Module}}/util/jsql"
)

func (r *StoreImpl) {{.ID}}() {{.ID}}Store {
	robj := &{{.ID}}StoreImpl{
		StoreImpl: r,
    qrySelectCountObj: qrySelectCountObj_{{.ID}},
    qrySelectObj: qrySelectObj_{{.ID}},
    qryFromObj:  qryFromObj_{{.ID}},
    scanObj:  scanObj_{{.ID}},
  }
  {{- range .Fields }}{{if eq .Type "many-to-many"}}
  robj.getObj_{{.ID}} = func(ctx context.Context, obj {{.Model.ID}}) ([]{{.Ref}}, error) {
    return getObj_{{.Model.ID}}_{{.ID}}(robj, ctx, obj)
  }
  {{- end}}{{end}}
  return robj
}

type {{.ID}}Store interface {
  Create(ctx context.Context, obj {{.ID}}) (*{{.ID}}, error)
  Get(ctx context.Context, {{template "ParamFk" . }}) (*{{.ID}}, error)
  {{range .Uniques -}}
  GetBy{{.ID}}(ctx context.Context, {{template "ParamUnique" . }}) (*{{.Model.ID}}, error)
  {{- end}}
  FindOne(ctx context.Context, filter []{{.ID}}Filter, sorting []{{.ID}}Sorting) (*{{.ID}}, error)
  Find(ctx context.Context, filter []{{.ID}}Filter, sorting []{{.ID}}Sorting, limit int, offset int64) ([]{{.ID}}, int64, error)
  Update(ctx context.Context, obj {{.ID}}, fields []{{.ID}}Field) error
  {{- range .Fields }}{{if eq .Type "password"}}
  Update{{.ID}}(ctx context.Context, {{template "ParamFkVersion" .Model }}, value string) error
  {{- end}}{{end}}
  Delete(ctx context.Context, {{template "ParamFk" . }}) error
}

type {{.ID}}StoreImpl struct {
  *StoreImpl
  qrySelectCountObj func() string
  qrySelectObj      func() string
  qryFromObj        func() string
  scanObj           func(obj *{{.ID}}, rows *sql.Rows) error
  {{- range .Fields }}{{if eq .Type "many-to-many"}}
    getObj_{{.ID}} func(ctx context.Context, obj {{.Model.ID}}) ([]{{.Ref}}, error)
  {{- end}}{{end}}
}
{{end -}}

{{- define "ParamFk" -}}
  {{ $idx := 0}}{{range .PKeys -}}
    {{if gt $idx 0}}, {{end}}{{$idx = add $idx 1}}{{.Name}} {{.GoType}}
  {{- end}}
{{- end -}}

{{- define "ParamFkVersion" -}}
  {{ $idx := 0}}{{range .PKeys -}}
    {{if gt $idx 0}}, {{end}}{{$idx = add $idx 1}}{{.Name}} {{.GoType}}
  {{- end}}
  {{- range .Fields }}{{if eq .Type "version" -}}
    {{if gt $idx 0}}, {{end}}{{$idx = add $idx 1}}{{.Name}} {{.GoType}}
  {{- end}}{{end}}
{{- end -}}

{{- define "ParamUnique" -}}
  {{- $idx := 0}}{{range .Fields -}}
    {{- if gt $idx 0}}, {{end}}{{$idx = add $idx 1}}{{.Name}} {{.GoType -}}
  {{- end}}
{{- end}}
